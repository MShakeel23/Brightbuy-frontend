# =====================================================
# APACHE .HTACCESS CONFIGURATION FILE
# =====================================================
# This is an Apache server configuration file, NOT PowerShell
# PowerShell syntax errors shown in IDE are false positives
# This file uses Apache mod_rewrite and mod_headers syntax
# =====================================================

# BrightBuy SEO and Performance Optimizations for Apache
# Place this file in the public directory for Apache servers

# Enable rewrite engine
RewriteEngine On

# Force HTTPS redirect
RewriteCond % { HTTPS } off
RewriteRule ^(.*)$ https://% { HTTP_HOST }% { REQUEST_URI } [L, R=301]

# Remove www from URL (optional - choose one)
RewriteCond % { HTTP_HOST } ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301, L]

# Handle React Router (SPA) - redirect all routes to index.html
RewriteCond % { REQUEST_FILENAME } !-f
RewriteCond % { REQUEST_FILENAME } !-d
RewriteRule . /index.html [L]

# Security Headers
<IfModule mod_headers.c>
# X-Content-Type-Options
Header always set X-Content-Type-Options nosniff
    
# X-Frame-Options
Header always set X-Frame-Options DENY
    
# X-XSS-Protection
Header always set X-XSS-Protection "1; mode=block"
    
# Referrer Policy
Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
# Content Security Policy (adjust as needed)
Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https:; frame-src 'none';"
</IfModule>

# Compression
<IfModule mod_deflate.c>
# Compress HTML, CSS, JavaScript, Text, XML and fonts
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/json
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE image/svg+xml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/javascript
AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE font/truetype
AddOutputFilterByType DEFLATE font/opentype
AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
    
# Remove browser bugs (only needed for really old browsers)
BrowserMatch ^Mozilla/4 gzip-only-text/html
BrowserMatch ^Mozilla/4\.0[678] no-gzip
BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
Header append Vary User-Agent
</IfModule>

# Browser Caching
<IfModule mod_expires.c>
ExpiresActive on
    
# Images
ExpiresByType image/jpg "access plus 1 month"
ExpiresByType image/jpeg "access plus 1 month"
ExpiresByType image/gif "access plus 1 month"
ExpiresByType image/png "access plus 1 month"
ExpiresByType image/svg+xml "access plus 1 month"
ExpiresByType image/webp "access plus 1 month"
ExpiresByType image/ico "access plus 1 month"
ExpiresByType image/x-icon "access plus 1 month"
    
# CSS and JavaScript
ExpiresByType text/css "access plus 1 month"
ExpiresByType application/javascript "access plus 1 month"
ExpiresByType text/javascript "access plus 1 month"
    
# Fonts
ExpiresByType font/truetype "access plus 1 month"
ExpiresByType font/opentype "access plus 1 month"
ExpiresByType application/vnd.ms-fontobject "access plus 1 month"
ExpiresByType font/woff "access plus 1 month"
ExpiresByType font/woff2 "access plus 1 month"
    
# HTML and XML
ExpiresByType text/html "access plus 0 seconds"
ExpiresByType text/xml "access plus 0 seconds"
ExpiresByType application/xml "access plus 0 seconds"
ExpiresByType application/json "access plus 0 seconds"
    
# Default
ExpiresDefault "access plus 2 days"
</IfModule>

# Cache-Control Headers
<IfModule mod_headers.c>
    # 1 Month for most static assets
    <FilesMatch "\.(css|jpg|jpeg|png|gif|js|ico|svg|woff|woff2|ttf|eot)$">
        Header set Cache-Control "max-age=2628000, public"
    </FilesMatch>
    
    # 1 Day for HTML
    <FilesMatch "\.(html|htm)$">
        Header set Cache-Control "max-age=86400, public, must-revalidate"
    </FilesMatch>
    
    # No cache for dynamic content
    <FilesMatch "\.(json|xml)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires 0
    </FilesMatch>
</IfModule>

# MIME Types for better SEO
<IfModule mod_mime.c>
# Proper MIME types
AddType application/javascript .js
AddType text/css .css
AddType image/svg+xml .svg
AddType application/vnd.ms-fontobject .eot
AddType font/truetype .ttf
AddType font/opentype .otf
AddType font/woff .woff
AddType font/woff2 .woff2
AddType application/json .json
AddType application/manifest+json .webmanifest
</IfModule>

# Prevent access to sensitive files
<FilesMatch "(^#.*#|\.(bak|config|dist|fla|inc|ini|log|psd|sh|sql|sw[op])|~)$">
    Order allow,deny
    Deny from all
    Satisfy All
</FilesMatch>

# Block access to .env files
<FilesMatch "\.env.*$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Custom 404 page (optional)
ErrorDocument 404 /index.html

# Disable server signature
ServerSignature Off